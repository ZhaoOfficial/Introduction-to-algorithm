# 1 拓扑排序 Topology sort

## 1.1 概述

对于一个有向无环图 [Directed Acyclic Graph (DAG)]，其拓扑排序是图种所有结点的一种线性次序，满足以下条件：

1. 如果图包含边 $(u,v)$ ，则在拓扑排序中，$u$ 处于 $v$ 之前。
2. 图不能包含环路。

拓扑排序不同于传统意义上的排序。

## 1.2 证明

一个图是有向无环图 (DAG) 当且仅当该图可以被拓扑排序。

### 1.2.1 $\Rightarrow$

**Lemma1：DAG 中至少有一个入结点度为0的点。**

Proof：

- 假设DAG中不存在这样一个点。
- 由于不存在入结点度为0的点，那么每一个点都会有一个前驱结点。
- 那么从任意一个结点开始，不断回溯该节点的任意一个前驱节点。
- 由于图是有限的，则必然会经过一个点两次，则形成了一个环。
- 这与 DAG 定义矛盾。
- 故 DAG 中至少有一个入结点度为0的点。

**Lemma2：DAG 的子图仍然是一个 DAG。**

Proof：

- 如果子图不是 DAG，那么子图中含有一个环路。
- 那么原图也含有一个环路。
- 这与原图是 DAG 矛盾。
- 故 DAG 的子图仍然是一个 DAG。



**一个图是 DAG $\Rightarrow$ 该图可以被拓扑排序。**

Proof：

- 1个结点的 DAG $G_1$ 是已经被排好的拓扑排序的结果。
- 假设 n 个结点的 DAG $G_n$ 可以被拓扑排序。
- 那么 n+1 个结点的 $G_{n+1}$也可以。
- 找到 $G_{n+1}$ 中入结点度为0的结点 $v$，移去。形成的 $G_n$ 可以被拓扑排序。在排序结果的起始位置加上结点 $v$，则对于 $G_{n+1}$ 的拓扑排序完成。

### 1.2.2 $\Leftarrow$

证明他的逆否命题是正确的，即一个图不是 DAG 则该图不可以被拓扑排序。

Proof：

- 非 DAG 图中存在一个环路。
- 对于环路上的任意两点 $v_1,v_2$ ，既存在 $v_1$ 到 $v_2$ 的路径，也存在 $v_2$ 到 $v_1$ 的路径。
- 则由拓扑排序的定义， $v_1$ 同时处在 $v_2$ 的之前和之后，但是只能出现一次，故矛盾。
- 则一个图不是 DAG 则该图不可以被拓扑排序。



## 1.3 算法描述

1. 把所有入结点度为0的点放入[结果queue] 。
2. 移去和[结果queue] 头元素的点相关的边，更新相关入结点度。
3. 把更新过的入结点度变为0的点放入[结果queue]。
4. pop [结果queue] 的头元素。
5. 重复2-3直到算法完成。
6. pop的顺序就是拓扑排序的顺序。

## 1.4 时间空间复杂度

空间复杂度：结果queue $\Theta(|V|)$ 

时间复杂度：移去边和点 $\Theta(|V|+|E|)$

本质：DFS。



# 2 关键路径 Critical Path

## 2.1 概述

有权的DAG，两个结点之间如果存在多条路径，寻找最小并行权重和。

## 2.2 算法描述

记录上一级结点的权重，如果有多条路径来到，取最大的那个 (必须要完成的时间)。